<html>
  <head>
    <!-- Moralis SDK code -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://unpkg.com/moralis/dist/moralis.js"></script>
    <script src="main.js"></script>
  </head>
  <body>
    <h1>NFT gallery</h1>


    <script>
        // connect to Moralis server

        const serverUrl = "https://9vtzpc9iazka.usemoralis.com:2053/server";
        const appId = "MV8q6Pmrk0siAvHHE2YseAr93Ed9JeMkG6nunTAK";
        Moralis.start({ serverUrl, appId });

        async function getNFTs(){
            // get polygon NFTs for address
            const options = { chain: "polygon", address: "0x3F0088f8a5a5c18eF04e8ED787f2B96986a09219" };
            const nfts = await Moralis.Web3.getNFTs(options);
            console.log(nfts);

            nfts.forEach(function(nft){
                let url = fixURL(nft.token_uri);

                fetch(url)
                .then(response => response.json())
                .then(data => {
                    $("#content").html($("content").html() + "<h2>" + data.name + "<h2>");
                    $("#content").html($("content").html() + "<h3>" + data.description + "<h3>");
                    $("#content").html($("content").html() + "<img width = 100 height = 100 src='" + data.image + "'>");
                })

            });
        }

        function fixURL(url){
            if(url.startsWith("ipfs")){
                return "https://ipfs.moralis.io:2053/ipfs/" + url.split("ipfs://ipfs/");
            } else {
                return url + "?format=json";
            }
        }

        getNFTs();


    </script>
  </body>
</html>